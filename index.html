<!DOCTYPE html>
<html lang="tk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <title>Salam · 2026 premium</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Seniň owadan stilleriň üýtgewsiz galdy */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        :root { --bg: #ffffff; --surface: rgba(255, 255, 255, 0.8); --text: #0a0a0c; --text-light: #2d2d32; --orange: #f97316; --blue: #3b82f6; --orange-soft: #fdba74; --blue-soft: #93c5fd; --glass-border: rgba(0, 0, 0, 0.1); --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.03); --nav-bg: rgba(255, 255, 255, 0.8); --card-bg: rgba(255, 255, 255, 0.5); --input-bg: rgba(255,255,255,0.7); --btn-border: rgba(0,0,0,0.15); }
        body.dark { --bg: #0a0a0c; --surface: rgba(18, 18, 22, 0.85); --text: #f0f0f0; --text-light: #b0b0b5; --orange: #f97316; --blue: #3b82f6; --orange-soft: #c2410c; --blue-soft: #1e3a8a; --glass-border: rgba(255, 255, 255, 0.06); --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.6); --nav-bg: rgba(10, 10, 12, 0.8); --card-bg: rgba(30, 30, 35, 0.6); --input-bg: rgba(255,255,255,0.08); --btn-border: rgba(255,255,255,0.15); }
        body { background-color: var(--bg); color: var(--text); transition: background 0.4s ease, color 0.2s; min-height: 100vh; position: relative; overflow-x: hidden; }
        .anim-glow { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; overflow: hidden; }
        .anim-glow span { position: absolute; width: 80vmax; height: 80vmax; border-radius: 50%; mix-blend-mode: soft-light; filter: blur(100px); animation: floatBlob 20s infinite alternate ease-in-out; opacity: 0.4; }
        .anim-glow .blob1 { background: var(--orange); top: -20%; left: -20%; animation-duration: 24s; }
        .anim-glow .blob2 { background: var(--blue); bottom: -20%; right: -15%; width: 90vmax; height: 90vmax; animation-duration: 28s; animation-delay: -5s; }
        .anim-glow .blob3 { background: var(--orange-soft); top: 30%; right: 10%; width: 70vmax; height: 70vmax; animation-duration: 22s; mix-blend-mode: overlay; }
        .anim-glow .blob4 { background: var(--blue-soft); bottom: 20%; left: 5%; width: 85vmax; height: 85vmax; animation-duration: 30s; mix-blend-mode: hard-light; opacity: 0.3; }
        @keyframes floatBlob { 0% { transform: translate(0, 0) scale(1); } 33% { transform: translate(4%, 6%) scale(1.1); } 66% { transform: translate(-8%, 3%) scale(0.95); } 100% { transform: translate(5%, -8%) scale(1.05); } }
        .container { max-width: 1400px; margin: 0 auto; padding: 0.8rem 1rem 2rem; position: relative; z-index: 2; }
        .top-bar { display: flex; flex-wrap: wrap; align-items: center; gap: 0.7rem; background: var(--nav-bg); backdrop-filter: blur(20px); border-radius: 2rem; padding: 0.8rem 1.2rem; border: 1px solid var(--glass-border); box-shadow: 0 8px 25px rgba(0,0,0,0.05); margin-bottom: 2rem; }
        .search-wrapper { flex: 3 1 200px; }
        .search-box { display: flex; align-items: center; background: var(--input-bg); border-radius: 3rem; padding: 0.6rem 1.2rem; border: 1px solid var(--glass-border); gap: 0.5rem; }
        .search-box input { background: transparent; border: none; width: 100%; color: var(--text); outline: none; }
        .phone { font-weight: 600; color: var(--blue); text-decoration: none; padding: 0.5rem 1rem; border-radius: 2rem; border: 1px solid var(--btn-border); background: var(--input-bg); display: inline-flex; align-items: center; gap: 0.4rem; }
        .theme-toggle { background: var(--input-bg); border: 1px solid var(--btn-border); border-radius: 2rem; width: 2.8rem; height: 2.8rem; display: flex; align-items: center; justify-content: center; color: var(--orange); cursor: pointer; }
        .section-title { font-size: 1.8rem; font-weight: 500; margin: 2.5rem 0 1.2rem; border-left: 6px solid var(--orange); padding-left: 1rem; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; }
        .product-card { background: var(--card-bg); backdrop-filter: blur(12px); border: 1px solid var(--glass-border); border-radius: 2rem; padding: 1.5rem; transition: 0.3s; cursor: pointer; text-align: center; }
        .product-card:hover { transform: translateY(-5px); border-color: var(--orange); }
        .product-img { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 1.8rem; margin-bottom: 1rem; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(10px); z-index: 2000; align-items: center; justify-content: center; padding: 1rem; }
        .modal.active { display: flex; }
        .modal-content { background: var(--surface); border-radius: 2.5rem; padding: 2rem; width: 100%; max-width: 450px; position: relative; border: 2px solid var(--orange); }
        .admin-trigger { position: fixed; bottom: 20px; right: 20px; width: 40px; height: 40px; opacity: 0; cursor: pointer; z-index: 999; }
        .admin-panel { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 400px; background: var(--surface); border-radius: 2rem; padding: 2rem; border: 2px solid var(--orange); z-index: 3000; }
        .admin-panel.show { display: block; }
        .admin-panel input, .admin-panel textarea, .admin-panel button { width: 100%; margin: 0.5rem 0; padding: 0.8rem; border-radius: 1rem; border: 1px solid #ccc; }
        .delete-prod { color: red; cursor: pointer; border: 1px solid red; padding: 2px 8px; border-radius: 5px; background: none; }
    </style>
</head>
<body>
    <div class="anim-glow"><span class="blob1"></span><span class="blob2"></span><span class="blob3"></span><span class="blob4"></span></div>

    <div class="container">
        <div class="top-bar">
            <div class="search-wrapper">
                <div class="search-box"><i class="fas fa-search"></i><input type="text" id="searchInput" placeholder="Gözleg..."></div>
            </div>
            <div class="actions">
                <a href="tel:+99364375286" class="phone"><i class="fas fa-phone-alt"></i><span>+993 64 37 52 86</span></a>
                <button class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i></button>
            </div>
        </div>

        <section id="products">
            <h2 class="section-title">Kolleksiýa</h2>
            <div class="product-grid" id="productGrid"></div>
        </section>
    </div>

    <div class="admin-trigger" id="adminTrigger"></div>

    <div class="admin-panel" id="adminPanel">
        <div id="adminLogin">
            <h3>Admin Giriş</h3>
            <input type="password" id="adminPass" placeholder="Parol">
            <button id="loginAdminBtn">Gir</button>
        </div>
        <div id="adminControls" style="display:none;">
            <h4>Täze Önüm Goş</h4>
            <input type="text" id="prodName" placeholder="Ady">
            <input type="text" id="prodPrice" placeholder="Bahasy (mysal: 150)">
            <textarea id="prodDesc" placeholder="Düşündiriş"></textarea>
            <input type="file" id="prodImage" accept="image/*">
            <button id="addProductBtn" style="background:var(--orange); color:white; font-weight:bold;">Goş</button>
            <hr><div id="adminProductList"></div>
            <button id="closeAdminBtn">Ýap</button>
        </div>
    </div>

    <div class="modal" id="productModal">
        <div class="modal-content">
            <span style="float:right; cursor:pointer; font-size:2rem;" id="closeModal">&times;</span>
            <img id="modalImage" src="" style="width:100%; border-radius:1rem;">
            <h2 id="modalName"></h2>
            <p id="modalPrice" style="color:var(--orange); font-size:1.5rem; font-weight:bold;"></p>
            <p id="modalDescription" style="margin-top:1rem;"></p>
        </div>
    </div>

    <script>
        // --- KONFIGURASIÝA ---
        const SUPABASE_URL = 'https://hkciztmtnqvcmvlogcdz.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_VURRdtnDXn7DSNW2S2xg9A_7H3-l-no';
        const IMGBB_KEY = '60a736976267dfafdfd0b7a90fc2b3ed';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function loadProducts() {
            const { data, error } = await supabase.from('products').select('*').order('id', { ascending: false });
            if (error) { console.error(error); return; }
            renderProducts(data);
            updateAdminProductList(data);
        }

        function renderProducts(data, filter = '') {
            const grid = document.getElementById('productGrid');
            const searchVal = document.getElementById('searchInput').value.toLowerCase();
            const filtered = data.filter(p => p.name.toLowerCase().includes(searchVal));
            
            grid.innerHTML = filtered.map(p => `
                <div class="product-card" onclick="showModal('${p.name}', '${p.image_url}', '${p.price}', '${p.description || ''}')">
                    <img src="${p.image_url}" class="product-img">
                    <div class="product-name">${p.name}</div>
                    <div class="product-price">${p.price} TMT</div>
                </div>
            `).join('');
        }

        async function onAddProduct() {
            const btn = document.getElementById('addProductBtn');
            const name = document.getElementById('prodName').value;
            const price = document.getElementById('prodPrice').value;
            const desc = document.getElementById('prodDesc').value;
            const file = document.getElementById('prodImage').files[0];

            if (!name || !price || !file) { alert("Doly dolduryň!"); return; }
            
            btn.innerText = "Ýüklenýär...";
            btn.disabled = true;

            // 1. ImgBB Upload
            const formData = new FormData();
            formData.append('image', file);
            const imgRes = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, { method: 'POST', body: formData });
            const imgData = await imgRes.json();

            if (imgData.success) {
                // 2. Supabase Upload
                const { error } = await supabase.from('products').insert([
                    { name, price, description: desc, image_url: imgData.data.url }
                ]);

                if (error) alert("Supabase ýalňyşlygy: " + error.message);
                else {
                    alert("Haryt goşuldy!");
                    location.reload();
                }
            } else {
                alert("Surat ýüklenmedi!");
            }
            btn.innerText = "Goş";
            btn.disabled = false;
        }

        function updateAdminProductList(data) {
            const list = document.getElementById('adminProductList');
            list.innerHTML = data.map(p => `
                <div style="display:flex; justify-content:space-between; margin:5px 0;">
                    <span>${p.name}</span>
                    <button class="delete-prod" onclick="deleteProduct(${p.id})">Poz</button>
                </div>
            `).join('');
        }

        async function deleteProduct(id) {
            if (confirm("Pozmak isleýärsiňizmi?")) {
                await supabase.from('products').delete().eq('id', id);
                location.reload();
            }
        }

        function showModal(name, img, price, desc) {
            document.getElementById('modalName').innerText = name;
            document.getElementById('modalImage').src = img;
            document.getElementById('modalPrice').innerText = price + " TMT";
            document.getElementById('modalDescription').innerText = desc;
            document.getElementById('productModal').classList.add('active');
        }

        // Event Listeners
        document.getElementById('closeModal').onclick = () => document.getElementById('productModal').classList.remove('active');
        document.getElementById('adminTrigger').onclick = () => document.getElementById('adminPanel').classList.toggle('show');
        document.getElementById('loginAdminBtn').onclick = () => {
            if (document.getElementById('adminPass').value === '1234') {
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminControls').style.display = 'block';
            }
        };
        document.getElementById('addProductBtn').onclick = onAddProduct;
        document.getElementById('searchInput').oninput = loadProducts;
        document.getElementById('closeAdminBtn').onclick = () => document.getElementById('adminPanel').classList.remove('show');

        // Tema
        document.getElementById('themeToggle').onclick = () => {
            document.body.classList.toggle('dark');
            const isDark = document.body.classList.contains('dark');
            document.querySelector('#themeToggle i').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
        };

        window.onload = loadProducts;
    </script>
</body>
</html>
